# 名片识别功能说明

## 功能概述

名片识别功能允许用户通过拍照或选择相册中的名片图片，自动识别并提取名片中的关键信息（姓名、职位、电话），然后自动填入个人资料表单中。

## 技术架构

### 1. 云函数 (recognizeBusinessCard)
- **位置**: `cloudfunctions/recognizeBusinessCard/`
- **功能**: 调用豆包视觉API进行名片识别
- **输入**: 图片的云存储URL
- **输出**: JSON格式的识别结果

### 2. 工具类 (BusinessCardRecognition)
- **位置**: `utils/businessCardRecognition.js`
- **功能**: 处理图片上传、云函数调用、结果处理
- **主要方法**:
  - `chooseAndRecognizeBusinessCard()`: 选择图片并识别
  - `recognizeBusinessCard(tempFilePath)`: 识别指定图片
  - `uploadImageToCloud(filePath)`: 上传图片到云存储

### 3. 页面集成
- **profile_setup页面**: 个人资料完善页面的名片识别
- **profile页面**: 个人资料编辑页面的名片识别

## 使用流程

1. **选择图片**: 用户点击"扫描名片自动填写"按钮
2. **图片上传**: 选择的图片上传到云存储
3. **调用识别**: 云函数调用豆包视觉API进行识别
4. **结果确认**: 显示识别结果供用户确认
5. **信息填入**: 用户确认后自动填入表单

## API配置

### 豆包视觉API
- **接口地址**: `https://ark.cn-beijing.volces.com/api/v3/chat/completions`
- **模型**: `doubao-1.5-vision-pro-250328`
- **认证**: Bearer Token
- **返回格式**: JSON

### 识别字段
```json
{
  "姓名": "识别到的姓名或'未能识别'",
  "公司": "识别到的公司或'未能识别'",
  "职位": "识别到的职位或'未能识别'",
  "电话": "识别到的电话或'未能识别'"
}
```

### 错误处理机制
- 当API调用失败、解析失败或返回格式异常时，云函数会返回包含所有字段的默认数据结构
- 所有字段都会被设置为"未能识别"
- 前端会正常显示识别结果对话框，用户可以看到所有字段的状态
- 只有非"未能识别"的字段才会被填入表单

## 部署说明

### 1. 云函数部署
```bash
# 进入云函数目录
cd cloudfunctions/recognizeBusinessCard

# 安装依赖
npm install

# 部署云函数
# 在微信开发者工具中右键点击云函数文件夹选择"上传并部署"
```

### 2. 权限配置
- 确保小程序有云存储权限
- 确保云函数有网络访问权限
- 配置豆包API的访问密钥

## 注意事项

1. **图片质量**: 建议使用清晰的名片图片以提高识别准确率
2. **网络环境**: 识别过程需要网络连接，建议在良好的网络环境下使用
3. **隐私保护**: 上传的名片图片会临时存储在云端，识别完成后可选择删除
4. **错误处理**: 如果识别失败，用户可以手动输入信息

## 扩展功能

未来可以考虑添加以下功能：
- 识别更多字段（公司名称、邮箱、地址等）
- 支持多语言名片识别
- 批量名片识别
- 名片信息的本地缓存

## 故障排除

### 常见问题
1. **识别失败**: 检查网络连接和API密钥配置
2. **图片上传失败**: 检查云存储权限配置
3. **识别结果不准确**: 尝试使用更清晰的图片或调整拍照角度

### 调试方法
- 查看云函数日志
- 检查网络请求状态
- 验证API返回结果格式