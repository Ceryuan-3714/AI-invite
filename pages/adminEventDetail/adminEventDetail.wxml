<!-- adminEventDetail.wxml -->
<view class="admin-event-detail-container">
  <!-- é¡µé¢åŠ è½½çŠ¶æ€ -->
  <view class="page-loading" wx:if="{{pageLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view class="content-container" wx:else>
    <!-- æ´»åŠ¨åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
    <view class="event-info-card">
      <view class="card-header">
        <text class="card-title">æ´»åŠ¨åŸºæœ¬ä¿¡æ¯</text>
        <view class="header-actions">
           <view class="view-detail-btn" bindtap="goToEventDetail">
             <text class="view-detail-icon">ğŸ‘ï¸</text>
             <text class="view-detail-text">å‰ç«¯æ´»åŠ¨è¯¦æƒ…</text>
           </view>
           <view class="edit-btn" bindtap="editEvent">
             <text class="edit-icon">âœï¸</text>
             <text class="edit-text">ç¼–è¾‘</text>
           </view>
         </view>
      </view>
      
      <view class="event-cover" wx:if="{{eventData.cover}}">
        <image class="cover-image" src="{{eventData.cover}}" mode="aspectFill"></image>
      </view>
      
      <view class="event-details">
        <view class="detail-row">
          <text class="detail-label">æ´»åŠ¨åç§°</text>
          <text class="detail-value">{{eventData.title || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ´»åŠ¨æ—¶é—´</text>
          <text class="detail-value">{{eventData.date}} {{eventData.startTime}}-{{eventData.endTime}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ´»åŠ¨åœ°ç‚¹</text>
          <text class="detail-value">{{eventData.location || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">ç»„ç»‡è€…</text>
          <text class="detail-value">{{eventData.organizer || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">è”ç³»ç”µè¯</text>
          <text class="detail-value">{{eventData.contact || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æœ€å¤§å‚ä¸äººæ•°</text>
          <text class="detail-value">{{eventData.maxAttendees || 'æœªé™åˆ¶'}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ´»åŠ¨çŠ¶æ€</text>
          <text class="detail-value status-{{eventData.status}}">{{eventData.statusText || 'å¾…å¼€å§‹'}}</text>
        </view>
      </view>
    </view>

    <!-- ç­¾åˆ°ä¿¡æ¯å¡ç‰‡ -->
    <view class="checkin-info-card">
      <view class="card-header">
        <text class="card-title">ç­¾åˆ°ä¿¡æ¯</text>
        <view class="checkin-actions">
          <view class="action-btn" bindtap="viewCheckinList">
            <text class="action-text">æŸ¥çœ‹ç­¾åˆ°åˆ—è¡¨</text>
          </view>
        </view>
      </view>
      
      <view class="checkin-stats">
        <view class="stat-item">
          <text class="stat-number">{{checkinStats.checkedIn || 0}}</text>
          <text class="stat-label">å·²ç­¾åˆ°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{checkinStats.notCheckedIn || 0}}</text>
          <text class="stat-label">æœªç­¾åˆ°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{checkinStats.total || 0}}</text>
          <text class="stat-label">æ€»å‚ä¸äººæ•°</text>
        </view>
      </view>
      
      <view class="checkin-config" wx:if="{{eventData.checkinConfig}}">
        <view class="config-row">
          <text class="config-label">ç­¾åˆ°åŠŸèƒ½</text>
          <text class="config-value">{{eventData.checkinConfig.enabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'}}</text>
        </view>
        <view class="config-row" wx:if="{{eventData.checkinConfig.enabled}}">
          <text class="config-label">å¼€æ”¾æ—¶é—´</text>
          <text class="config-value">æ´»åŠ¨å¼€å§‹å‰{{eventData.checkinConfig.openTimeOffset || 0}}åˆ†é’Ÿ</text>
        </view>
      </view>
    </view>

    <!-- åŠ åœºæ„æ„¿ä¿¡æ¯å¡ç‰‡ -->
    <view class="additional-session-card">
      <view class="card-header">
        <text class="card-title">åŠ åœºæ„æ„¿ç»Ÿè®¡</text>
        <view class="action-btn" bindtap="viewAdditionalSessionDetails">
          <text class="action-text">æŸ¥çœ‹è¯¦æƒ…</text>
        </view>
      </view>
      
      <view class="session-stats">
        <view class="stat-item">
          <text class="stat-number">{{additionalSessionStats.interested || 0}}</text>
          <text class="stat-label">æœ‰æ„æ„¿</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{additionalSessionStats.notInterested || 0}}</text>
          <text class="stat-label">æ— æ„æ„¿</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{additionalSessionStats.pending || 0}}</text>
          <text class="stat-label">æœªå›å¤</text>
        </view>
      </view>
    </view>

    <!-- è¯é¢˜æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="topic-survey-card" wx:if="{{eventData.topicSurvey && eventData.topicSurvey.enabled}}">
      <view class="card-header">
        <text class="card-title">è¯é¢˜æ”¶é›†ç»Ÿè®¡</text>
        <view class="action-btn" bindtap="viewTopicSurveyDetails">
          <text class="action-text">æŸ¥çœ‹è¯¦æƒ…</text>
        </view>
      </view>
      
      <view class="topic-question">
        <text class="question-text">{{eventData.topicSurvey.question}}</text>
      </view>
      
      <view class="topic-options">
        <view class="option-item" wx:for="{{topicSurveyStats}}" wx:key="option">
          <view class="option-info">
            <text class="option-text">{{item.option}}</text>
            <text class="option-count">{{item.count}}ç¥¨ ({{item.percentage}}%)</text>
          </view>
          <view class="option-bar">
            <view class="option-fill" style="width: {{item.percentage}}%"></view>
          </view>
        </view>
      </view>
      
      <view class="topic-submissions" wx:if="{{topicSubmissions.length > 0}}">
        <text class="submissions-title">æœ€æ–°æäº¤è®°å½•ï¼š</text>
        <view class="submission-item" wx:for="{{topicSubmissions}}" wx:key="_id" wx:for-index="idx" wx:if="{{idx < 3}}">
          <text class="submission-name">{{item.name}}</text>
          <text class="submission-prefer">é€‰æ‹©ï¼š{{item.prefer}}</text>
          <text class="submission-time">{{item.submitTime}}</text>
        </view>
      </view>
    </view>

    <!-- äºŒç»´ç ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="qrcode-stats-card">
      <view class="card-header">
        <text class="card-title">äºŒç»´ç ç»Ÿè®¡</text>
        <view class="qrcode-actions">
          <view class="action-btn" bindtap="goToQRCodeManagement">
            <text class="action-text">ç®¡ç†äºŒç»´ç </text>
          </view>
        </view>
      </view>
      
      <view class="qrcode-overview">
        <view class="stat-item">
          <text class="stat-number">{{qrCodeStats.totalQRCodes || 0}}</text>
          <text class="stat-label">äºŒç»´ç æ€»æ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{qrCodeStats.totalScans || 0}}</text>
          <text class="stat-label">æ€»æ‰«ææ¬¡æ•°</text>
        </view>
      </view>
      
      <!-- äºŒç»´ç è¯¦ç»†åˆ—è¡¨ -->
      <view class="qrcode-list" wx:if="{{qrCodeStats.qrCodeList.length > 0}}">
        <text class="list-title">æ‰«ææ’è¡Œæ¦œï¼š</text>
        <view class="qrcode-item" wx:for="{{qrCodeStats.qrCodeList}}" wx:key="_id" wx:for-index="idx" wx:if="{{idx < 5}}">
          <view class="qrcode-rank">{{idx + 1}}</view>
          <view class="qrcode-info">
            <text class="qrcode-name">{{item.name}}</text>
            <text class="qrcode-count">æ‰«ææ¬¡æ•°ï¼š{{item.count}}</text>
          </view>
        </view>
      </view>
      
      <view class="qrcode-empty" wx:if="{{qrCodeStats.totalQRCodes === 0}}">
        <text class="empty-text">æš‚æ— äºŒç»´ç æ•°æ®</text>
        <text class="empty-desc">åˆ›å»ºäºŒç»´ç åå¯æŸ¥çœ‹æ‰«æç»Ÿè®¡</text>
      </view>
    </view>

    <!-- å‚ä¸äººå‘˜å¡ç‰‡ -->
    <view class="participants-card">
      <view class="card-header">
        <text class="card-title">å‚ä¸äººå‘˜ ({{participants.length}})</text>
        <view class="participants-actions">
          <view class="action-btn" bindtap="exportParticipants">
            <text class="action-text">å¯¼å‡ºåå•</text>
          </view>
          <view class="action-btn" bindtap="viewAllParticipants">
            <text class="action-text">æŸ¥çœ‹å…¨éƒ¨</text>
          </view>
        </view>
      </view>
      
      <!-- å‚ä¸è€…åˆ—è¡¨ -->
      <view class="participants-list">
        <view class="participant-item" wx:for="{{displayedParticipants}}" wx:key="_id">
          <image class="participant-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="participant-info">
            <text class="participant-name">{{item.name || 'æœªè®¾ç½®å§“å'}}</text>
            <text class="participant-company">{{item.companyPositionText || ((item.company || '') + ' ' + (item.position || '')) || 'æœªçŸ¥å…¬å¸'}}</text>
          </view>
          <view class="participant-status">
            <text class="status-text status-{{item.checkinStatus}}">{{item.checkinStatus === 'checked' ? 'å·²ç­¾åˆ°' : 'æœªç­¾åˆ°'}}</text>
          </view>
          <view class="participant-detail-btn" bindtap="viewParticipantDetail">
            <text class="detail-btn-text">æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
        </view>
        
        <!-- åˆ†é¡µæ§åˆ¶ -->
        <view class="pagination-controls" wx:if="{{participants.length > participantsPerPage}}">
          <view class="pagination-info">
            <text class="page-info">ç¬¬ {{currentParticipantPage}} é¡µï¼Œå…± {{Math.ceil(participants.length / participantsPerPage)}} é¡µ</text>
          </view>
          <view class="pagination-buttons">
            <button class="page-btn" bindtap="prevParticipantPage" disabled="{{currentParticipantPage === 1}}">ä¸Šä¸€é¡µ</button>
            <button class="page-btn" bindtap="nextParticipantPage" disabled="{{currentParticipantPage === Math.ceil(participants.length / participantsPerPage)}}">ä¸‹ä¸€é¡µ</button>
          </view>
        </view>
      </view>
    </view>


  </view>
</view>